# Миграция на версию 2.0

## Что изменилось

Бот теперь поддерживает:
- ✅ Множественные плейлисты (каждый пользователь может создать свой)
- ✅ Шаринг плейлистов через ссылки
- ✅ Разделение на "мои плейлисты" и "плейлисты, куда я добавляю"
- ✅ Управление доступом (создатель может редактировать, участники только добавлять)
- ✅ База данных SQLite для хранения всех данных
- ✅ Возможность использовать свой токен Яндекс.Музыки

## Как перейти на новую версию

### 1. Резервное копирование

Сохраните текущий `bot.py`:
```bash
cp bot.py bot_old.py
```

### 2. Установка новой версии

Новая версия находится в файле `bot_v2.py`. Чтобы использовать её:

```bash
# Вариант 1: Заменить старый файл
mv bot_v2.py bot.py

# Вариант 2: Оставить оба и запускать новый
python bot_v2.py
```

### 3. Первый запуск

При первом запуске автоматически создастся база данных `bot.db` со всеми необходимыми таблицами.

### 4. Миграция старого плейлиста (опционально)

Если у вас был старый плейлист, который вы хотите добавить в новую систему, используйте скрипт миграции:

```python
# migrate_old_playlist.py
from database import Database
import os
from dotenv import load_dotenv

load_dotenv()

db = Database()

# Получаем данные старого плейлиста из .env
PLAYLIST_OWNER_ID = os.getenv("PLAYLIST_OWNER_ID")
PLAYLIST_ID = os.getenv("PLAYLIST_ID")
PLAYLIST_KIND = os.getenv("PLAYLIST_KIND") or os.getenv("PLAYLIST_ID")

# Создаем запись в БД (creator_telegram_id = 0 для дефолтного аккаунта)
playlist_id = db.create_playlist(
    playlist_kind=PLAYLIST_KIND,
    owner_id=PLAYLIST_OWNER_ID,
    creator_telegram_id=0,  # Дефолтный аккаунт
    title="Мой старый плейлист"
)

print(f"Старый плейлист добавлен в БД с ID: {playlist_id}")
```

## Новые команды

- `/create_playlist <название>` - создать новый плейлист
- `/my_playlists` - показать плейлисты, которые вы создали
- `/shared_playlists` - показать плейлисты, куда вы добавляете
- `/playlist_info [номер]` - информация о плейлисте
- `/set_token <токен>` - установить свой токен Яндекс.Музыки
- `/edit_name <новое название>` - изменить название плейлиста (только для создателя)
- `/delete_playlist` - удалить плейлист из БД (только для создателя)

## Как работает шаринг

1. Создайте плейлист: `/create_playlist Моя музыка`
2. Бот отправит вам ссылку вида: `https://t.me/your_bot?start=TOKEN`
3. Отправьте эту ссылку друзьям
4. Когда они перейдут по ссылке или отправят токен боту, они получат доступ на добавление треков

## Использование своего токена

⚠️ **ВНИМАНИЕ**: Передача токена боту происходит на ваш страх и риск!

1. Получите токен: https://yandex-music.readthedocs.io/en/main/token.html
2. Установите: `/set_token <ваш_токен>`
3. Теперь ваши плейлисты будут создаваться в вашем аккаунте Яндекс.Музыки

## Обратная совместимость

Старые команды (`/list`, `/queen_liza`) продолжают работать, но теперь работают с активным плейлистом пользователя.

## Структура базы данных

- `users` - пользователи Telegram
- `yandex_accounts` - аккаунты Яндекс.Музыки (дефолтный + пользовательские)
- `playlists` - плейлисты
- `playlist_access` - права доступа к плейлистам
- `actions` - история действий пользователей

## Ограничения

- Лимит плейлистов в Яндекс.Музыке: **800 плейлистов** на аккаунт
- Название плейлиста: максимум 100 символов

