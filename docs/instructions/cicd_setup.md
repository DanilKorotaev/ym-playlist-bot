# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
2025-12-02

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CI/CD (Continuous Integration / Continuous Deployment) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Telegram-–±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GitHub Actions.

**–¶–µ–ª–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –¥–µ–ø–ª–æ–µ
- –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

---

## 1. –ê–Ω–∞–ª–∏–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π GitHub Actions

### 1.1. –ß—Ç–æ —Ç–∞–∫–æ–µ GitHub Actions?

GitHub Actions ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ CI/CD –æ—Ç GitHub, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏ 2000 –º–∏–Ω—É—Ç/–º–µ—Å—è—Ü –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ YAML —Ñ–∞–π–ª—ã
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Docker –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ GitHub Secrets
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (manual trigger)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–π

### 1.2. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** –ø—Ä–∏ push –≤ –≤–µ—Ç–∫—É `main`
2. **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫** (manual trigger) –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
3. **–°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** —á–µ—Ä–µ–∑ SSH
5. **–û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏** —á–µ—Ä–µ–∑ —Ç–µ–≥–∏ –∏–ª–∏ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- GitHub Actions –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º
- –¢—Ä–µ–±—É–µ—Ç—Å—è SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- –î–ª—è Docker registry (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CI/CD

### 2.1. –°—Ö–µ–º–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

```
[GitHub Repository]
    |
    | (push –≤ main –∏–ª–∏ manual trigger)
    |
[GitHub Actions Workflow]
    |
    | (SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
    |
[Production Server]
    |
    | (docker compose)
    |
[Docker Containers]
    ‚îú‚îÄ‚îÄ bot (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
    ‚îú‚îÄ‚îÄ postgres (–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
    ‚îî‚îÄ‚îÄ pgadmin (–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
```

### 2.2. –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

1. **–¢—Ä–∏–≥–≥–µ—Ä**: Push –≤ –≤–µ—Ç–∫—É `main` –∏–ª–∏ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É**: SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–µ–∫—Ä–µ—Ç–æ–≤
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞**: `git pull` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. **–°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞**: `docker compose build bot`
5. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**: `docker compose stop bot`
6. **–ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**: `docker compose up -d bot`
7. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ
8. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**: (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º/–Ω–µ—É—Å–ø–µ—à–Ω–æ–º –¥–µ–ø–ª–æ–µ

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

### 3.1. –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ–∫—Ä–µ—Ç—ã

–î–ª—è —Ä–∞–±–æ—Ç—ã CI/CD –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:

1. **`DEPLOY_HOST`** ‚Äî IP-–∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞
2. **`DEPLOY_USER`** ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è 
3. **`DEPLOY_SSH_KEY`** ‚Äî –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É (–ë–ï–ó passphrase!)
4. **`DEPLOY_PATH`** ‚Äî –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã:**
- **`DEPLOY_PORT`** ‚Äî SSH –ø–æ—Ä—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 22)
- **`TELEGRAM_NOTIFICATION_TOKEN`** ‚Äî —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –¥–µ–ø–ª–æ–µ
- **`TELEGRAM_NOTIFICATION_CHAT_ID`** ‚Äî ID —á–∞—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 3.2. –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
3. –ù–∞–∂–º–∏—Ç–µ **New repository secret**
4. –í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–µ–∫—Ä–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `DEPLOY_HOST`)
5. –í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞
6. –ù–∞–∂–º–∏—Ç–µ **Add secret**
7. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤

### 3.3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–∞ –¥–ª—è –¥–µ–ø–ª–æ—è

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –î–ª—è CI/CD –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å SSH –∫–ª—é—á **–ë–ï–ó –ü–ê–†–û–õ–Ø (passphrase)**! GitHub Actions –Ω–µ –º–æ–∂–µ—Ç –≤–≤–æ–¥–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ –Ω–µ–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ.

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫–∞–∫ root):**

```bash
# –°–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è CI/CD –ë–ï–ó –ü–ê–†–û–õ–Ø
# –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ passphrase –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ Enter (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º)
ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/github_actions_deploy -N ""

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è .ssh —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
mkdir -p ~/.ssh
chmod 700 ~/.ssh

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ authorized_keys
cat ~/.ssh/github_actions_deploy.pub >> ~/.ssh/authorized_keys

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
chmod 600 ~/.ssh/authorized_keys
chmod 600 ~/.ssh/github_actions_deploy
chmod 644 ~/.ssh/github_actions_deploy.pub
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á —Å–æ–∑–¥–∞–Ω –±–µ–∑ passphrase
ssh-keygen -y -f ~/.ssh/github_actions_deploy
# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
```

**–í GitHub Secrets:**

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞:
   ```bash
   cat ~/.ssh/github_actions_deploy
   ```
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å –≤—ã–≤–æ–¥**, –≤–∫–ª—é—á–∞—è —Å—Ç—Ä–æ–∫–∏ `-----BEGIN OPENSSH PRIVATE KEY-----` –∏ `-----END OPENSSH PRIVATE KEY-----`
3. –î–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ GitHub Secret `DEPLOY_SSH_KEY`:
   - Settings ‚Üí Secrets and variables ‚Üí Actions
   - New repository secret
   - Name: `DEPLOY_SSH_KEY`
   - Value: –≤—Å—Ç–∞–≤—å—Ç–µ –≤–µ—Å—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á

**–í–∞–∂–Ω–æ:** 
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ SSH –∫–ª—é—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!
- –ö–ª—é—á –¥–ª—è CI/CD –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ë–ï–ó passphrase
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª—é—á —Ç–æ–ª—å–∫–æ –¥–ª—è CI/CD, –Ω–µ –≤–∞—à –ª–∏—á–Ω—ã–π –∫–ª—é—á

---

## 4. –°–æ–∑–¥–∞–Ω–∏–µ GitHub Actions Workflow

### 4.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ workflow

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.github/workflows/deploy.yml` –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```yaml
name: Deploy to Production

on:
  push:
    branches:
      - main
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Deploy to server
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ${{ secrets.DEPLOY_USER }}
          key: ${{ secrets.DEPLOY_SSH_KEY }}
          port: ${{ secrets.DEPLOY_PORT || 22 }}
          script: |
            cd ${{ secrets.DEPLOY_PATH }}
            git pull origin main
            docker compose build bot
            docker compose stop bot
            docker compose up -d bot
            docker compose ps
```

### 4.2. –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä workflow —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.github/workflows/deploy.yml`:

```yaml
name: Deploy to Production

on:
  push:
    branches:
      - main
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

env:
  DEPLOY_PATH: ${{ secrets.DEPLOY_PATH }}

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Deploy to server
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ${{ secrets.DEPLOY_USER }}
          key: ${{ secrets.DEPLOY_SSH_KEY }}
          port: ${{ secrets.DEPLOY_PORT || 22 }}
          script: |
            set -e  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            
            echo "üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è..."
            
            # –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
            cd ${{ secrets.DEPLOY_PATH }}
            
            # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ (–¥–ª—è –æ—Ç–∫–∞—Ç–∞)
            CURRENT_VERSION=$(git rev-parse --short HEAD)
            echo "üìå –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: $CURRENT_VERSION"
            echo "$CURRENT_VERSION" > .deploy_version
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
            echo "üì• –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
            git fetch origin
            git reset --hard origin/main
            git clean -fd
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
            NEW_VERSION=$(git rev-parse --short HEAD)
            echo "üìå –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: $NEW_VERSION"
            
            # –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞
            echo "üî® –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞..."
            docker compose build bot
            
            # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            echo "‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
            docker compose stop bot || true
            
            # –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            echo "üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
            docker compose rm -f bot || true
            
            # –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            echo "‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
            docker compose up -d bot
            
            # –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
            sleep 5
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
            docker compose ps
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏
            echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤..."
            if docker compose logs --tail=50 bot | grep -i "error\|exception\|traceback"; then
              echo "‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö!"
              docker compose logs --tail=100 bot
              exit 1
            fi
            
            echo "‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!"
            echo "üìå –í–µ—Ä—Å–∏—è: $NEW_VERSION"
      
      - name: Send notification (optional)
        if: always()
        uses: appleboy/telegram-action@v1.0.0
        with:
          to: ${{ secrets.TELEGRAM_NOTIFICATION_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_NOTIFICATION_TOKEN }}
          message: |
            ${{ job.status == 'success' && '‚úÖ' || '‚ùå' }} –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω
            
            –°—Ç–∞—Ç—É—Å: ${{ job.status }}
            –í–µ—Ä—Å–∏—è: ${{ github.sha }}
            –ö–æ–º–º–∏—Ç: ${{ github.event.head_commit.message }}
            –ê–≤—Ç–æ—Ä: ${{ github.event.head_commit.author.name }}
        env:
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_NOTIFICATION_CHAT_ID }}
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_NOTIFICATION_TOKEN }}
```

### 4.3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º docker-compose –Ω–∞–ø—Ä—è–º—É—é

–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `docker-compose` (V1), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç:

```yaml
# –í —Å–µ–∫—Ü–∏–∏ script –∑–∞–º–µ–Ω–∏—Ç–µ docker compose –Ω–∞ docker-compose
script: |
  cd ${{ secrets.DEPLOY_PATH }}
  git pull origin main
  docker-compose build bot
  docker-compose stop bot
  docker-compose up -d bot
  docker-compose ps
```

---

## 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è CI/CD

### 5.1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:**
- Git
- Docker
- Docker Compose (V2) –∏–ª–∏ docker-compose (V1)
- SSH —Å–µ—Ä–≤–µ—Ä

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Git
git --version

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
docker --version

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker Compose
docker compose version  # V2
# –∏–ª–∏
docker-compose --version  # V1
```

### 5.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω):**

```bash
cd ~
git clone <your-repo-url> ym-playlist-bot
cd ym-playlist-bot
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ pull:**

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Git (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
git config --global user.name "Deploy Bot"
git config --global user.email "deploy@example.com"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ pull –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
git config pull.rebase false
```

### 5.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

**–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞:**
- –ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –ó–∞–ø—É—Å–∫ Docker –∫–æ–º–∞–Ω–¥ (–±–µ–∑ sudo)

```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω)
sudo usermod -aG docker $USER

# –í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø–∏–ª–∏ –≤ —Å–∏–ª—É
# –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
newgrp docker

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
docker ps  # –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ sudo
```

### 5.4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –¥–ª—è CI/CD

**–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–µ–ø–ª–æ—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo adduser deploy-bot

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker deploy-bot

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–∞
sudo -u deploy-bot mkdir -p /home/deploy-bot/.ssh
sudo -u deploy-bot chmod 700 /home/deploy-bot/.ssh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ GitHub Actions
sudo -u deploy-bot nano /home/deploy-bot/.ssh/authorized_keys
# –í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∏–∑ ~/.ssh/github_actions_deploy.pub

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤
sudo -u deploy-bot chmod 600 /home/deploy-bot/.ssh/authorized_keys
```

**–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å Docker –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ sudo
- SSH –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ `~/.ssh/authorized_keys`

---

## 6. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è (Manual Trigger)

### 6.1. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GitHub UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Actions**
3. –í—ã–±–µ—Ä–∏—Ç–µ workflow **Deploy to Production**
4. –ù–∞–∂–º–∏—Ç–µ **Run workflow**
5. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É (–æ–±—ã—á–Ω–æ `main`)
6. –ù–∞–∂–º–∏—Ç–µ **Run workflow**

### 6.2. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GitHub CLI

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ GitHub CLI (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
# macOS: brew install gh
# Linux: sudo apt install gh

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
gh auth login

# –ó–∞–ø—É—Å–∫ workflow
gh workflow run deploy.yml
```

### 6.3. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä—É—á–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É

–ß—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –≤ workflow:

```yaml
jobs:
  deploy:
    runs-on: ubuntu-latest
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
    if: github.event_name == 'push' || github.event.pull_request.merged == true || github.actor == 'your-username'
    
    steps:
      # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏
```

---

## 7. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ push –≤ main

### 7.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞

Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push –≤ –≤–µ—Ç–∫—É `main` –±–ª–∞–≥–æ–¥–∞—Ä—è –Ω–∞—Å—Ç—Ä–æ–π–∫–µ:

```yaml
on:
  push:
    branches:
      - main
```

### 7.2. –ó–∞—â–∏—Ç–∞ –≤–µ—Ç–∫–∏ main (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–î–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–µ–ø–ª–æ–µ–≤ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∑–∞—â–∏—Ç—É –≤–µ—Ç–∫–∏ `main`:

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Settings** ‚Üí **Branches**
2. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –≤–µ—Ç–∫–∏ `main`:
   - ‚úÖ Require pull request reviews before merging
   - ‚úÖ Require status checks to pass before merging
   - ‚úÖ Require branches to be up to date before merging
   - ‚úÖ Include administrators

### 7.3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–≥–æ–≤ –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

–î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–≥–∏:

```yaml
on:
  push:
    tags:
      - 'v*'  # –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞ v1.0.0, v1.1.0 –∏ —Ç.–¥.
```

**–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞:**

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞
git tag -a v1.0.0 -m "Release version 1.0.0"

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–≥–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git push origin v1.0.0
```

---

## 8. –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è: –¥–µ—Ç–∞–ª–∏

### 8.1. –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞

```bash
docker compose build bot
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Docker —á–∏—Ç–∞–µ—Ç `Dockerfile`
- –°–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ —Å —Ç–µ–≥–æ–º –∏–∑ `docker-compose.yml`
- –ö—ç—à–∏—Ä—É–µ—Ç —Å–ª–æ–∏ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å–±–æ—Ä–æ–∫

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.dockerignore` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞ (multi-stage build) –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞

### 8.2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker compose stop bot
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `ym_bot`
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –∑–∞–ø—É—â–µ–Ω
- –î–∞–Ω–Ω—ã–µ –≤ volumes —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ):**

```bash
docker compose stop bot
docker compose rm -f bot  # –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```

### 8.3. –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
docker compose up -d bot
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (`-d`)
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç –∫ —Å–µ—Ç–∏ `bot_network`
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env`

### 8.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
docker compose ps
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```
NAME              IMAGE           STATUS
ym_bot            bot:latest      Up 2 minutes
ym_bot_postgres   postgres:15     Up 5 days
ym_bot_pgadmin    pgadmin:8       Up 5 days
```

---

## 9. –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

### 9.1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏

Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –≤ —Ñ–∞–π–ª `.deploy_version`:

```bash
CURRENT_VERSION=$(git rev-parse --short HEAD)
echo "$CURRENT_VERSION" > .deploy_version
```

### 9.2. –†—É—á–Ω–æ–π –æ—Ç–∫–∞—Ç —á–µ—Ä–µ–∑ SSH

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É:**

```bash
ssh user@your-server
cd /path/to/project
```

**–û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏:**

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–º–º–∏—Ç–æ–≤
git log --oneline -10

# –û—Ç–∫–∞—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ–º–º–∏—Ç—É
git checkout <commit-hash>
docker compose build bot
docker compose stop bot
docker compose up -d bot

# –ò–ª–∏ –æ—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É
git checkout HEAD~1
docker compose build bot
docker compose stop bot
docker compose up -d bot
```

**–û—Ç–∫–∞—Ç –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏:**

```bash
# –ß—Ç–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
PREVIOUS_VERSION=$(cat .deploy_version)

# –û—Ç–∫–∞—Ç –∫ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏
git checkout $PREVIOUS_VERSION
docker compose build bot
docker compose stop bot
docker compose up -d bot
```

### 9.3. –û—Ç–∫–∞—Ç —á–µ—Ä–µ–∑ GitHub Actions

–°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π workflow –¥–ª—è –æ—Ç–∫–∞—Ç–∞ (`.github/workflows/rollback.yml`):

```yaml
name: Rollback to Previous Version

on:
  workflow_dispatch:
    inputs:
      commit_hash:
        description: 'Commit hash to rollback to'
        required: true

jobs:
  rollback:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Rollback on server
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ${{ secrets.DEPLOY_USER }}
          key: ${{ secrets.DEPLOY_SSH_KEY }}
          script: |
            cd ${{ secrets.DEPLOY_PATH }}
            git checkout ${{ github.event.inputs.commit_hash }}
            docker compose build bot
            docker compose stop bot
            docker compose up -d bot
            docker compose ps
```

---

## 10. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 10.1. –ó–∞—â–∏—Ç–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤

**–ü—Ä–∞–≤–∏–ª–∞:**
- ‚úÖ –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GitHub Secrets –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Å–µ–∫—Ä–µ—Ç–∞–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º workflow
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ SSH –∫–ª—é—á–∏ –∏ —Ç–æ–∫–µ–Ω—ã

### 10.2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ workflow

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Settings** ‚Üí **Actions** ‚Üí **General**
2. –í —Ä–∞–∑–¥–µ–ª–µ **Workflow permissions**:
   - –í—ã–±–µ—Ä–∏—Ç–µ **Read and write permissions** (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é)
   - –ò–ª–∏ **Read repository contents and packages permissions** (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
3. –û—Ç–º–µ—Ç—å—Ç–µ **Allow GitHub Actions to create and approve pull requests** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### 10.3. SSH –∫–ª—é—á–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è CI/CD (–Ω–µ –ª–∏—á–Ω—ã–π)
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø—Ä–∞–≤–∞ –∫–ª—é—á–∞ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ (–∫–∞–∂–¥—ã–µ 3-6 –º–µ—Å—è—Ü–µ–≤)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á–∏ —Å –ø–∞—Ä–æ–ª–µ–º (passphrase) –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ SSH –∫–ª—é—á–∞:**

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `~/.ssh/authorized_keys` —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏:

```
command="cd /path/to/project && $SSH_ORIGINAL_COMMAND",no-port-forwarding,no-X11-forwarding,no-agent-forwarding ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAA... github-actions-deploy
```

### 10.4. Firewall –∏ —Å–µ—Ç—å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ SSH –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å IP-–∞–¥—Ä–µ—Å–æ–≤ GitHub Actions (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ fail2ban –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ—Ä—Ç–∞–º

**IP-–∞–¥—Ä–µ—Å–∞ GitHub Actions:**

GitHub Actions –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ IP-–∞–¥—Ä–µ—Å–∞. –î–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- VPN —Ç—É–Ω–Ω–µ–ª—å
- GitHub Actions IP ranges (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

---

## 11. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 11.1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather)
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
3. –£–∑–Ω–∞–π—Ç–µ –≤–∞—à Chat ID (–æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É [@userinfobot](https://t.me/userinfobot))
4. –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:
   - `TELEGRAM_NOTIFICATION_TOKEN`
   - `TELEGRAM_NOTIFICATION_CHAT_ID`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ workflow:**

```yaml
- name: Send notification
  if: always()  # –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –ª—é–±–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
  uses: appleboy/telegram-action@v1.0.0
  with:
    to: ${{ secrets.TELEGRAM_NOTIFICATION_CHAT_ID }}
    token: ${{ secrets.TELEGRAM_NOTIFICATION_TOKEN }}
    message: |
      ${{ job.status == 'success' && '‚úÖ' || '‚ùå' }} –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω
      –°—Ç–∞—Ç—É—Å: ${{ job.status }}
      –í–µ—Ä—Å–∏—è: ${{ github.sha }}
```

### 11.2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ø–ª–æ–µ–≤

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ GitHub:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Actions**
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π workflow run
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ job **deploy**
4. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

**–õ–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
docker compose logs -f bot

# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose logs -f

# –õ–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
docker compose logs --since 1h bot
```

### 11.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ health check –≤ workflow:**

```yaml
- name: Health check
  uses: appleboy/ssh-action@v1.0.0
  with:
    host: ${{ secrets.DEPLOY_HOST }}
    username: ${{ secrets.DEPLOY_USER }}
    key: ${{ secrets.DEPLOY_SSH_KEY }}
    script: |
      # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω
      if ! docker compose ps bot | grep -q "Up"; then
        echo "‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω!"
        exit 1
      fi
      
      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏
      if docker compose logs --tail=50 bot | grep -i "error\|exception"; then
        echo "‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö!"
        exit 1
      fi
      
      echo "‚úÖ Health check –ø—Ä–æ–π–¥–µ–Ω"
```

---

## 12. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### 12.1. –û—à–∏–±–∫–∞ —Å passphrase SSH –∫–ª—é—á–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** `Enter passphrase for (stdin):` –∏–ª–∏ `Error: Command failed: ssh-add -`

**–ü—Ä–∏—á–∏–Ω–∞:** SSH –∫–ª—é—á –∑–∞—â–∏—â–µ–Ω –ø–∞—Ä–æ–ª–µ–º (passphrase), –∞ GitHub Actions –Ω–µ –º–æ–∂–µ—Ç –≤–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å –≤ –Ω–µ–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ.

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π SSH –∫–ª—é—á **–ë–ï–ó passphrase** —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è CI/CD:
   ```bash
   ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/github_actions_deploy -N ""
   ```
   –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ passphrase –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ Enter (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º).

2. –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
   ```bash
   cat ~/.ssh/github_actions_deploy.pub >> ~/.ssh/authorized_keys
   chmod 600 ~/.ssh/authorized_keys
   ```

3. –û–±–Ω–æ–≤–∏—Ç–µ GitHub Secret `DEPLOY_SSH_KEY` –Ω–æ–≤—ã–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º:
   ```bash
   cat ~/.ssh/github_actions_deploy
   ```
   –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –≤—ã–≤–æ–¥ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ GitHub Secrets.

**–í–∞–∂–Ω–æ:** –î–ª—è CI/CD –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á–∏ –±–µ–∑ passphrase. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–ª—é—á–∞ –≤ GitHub Secrets, –∞ –Ω–µ –ø–∞—Ä–æ–ª–µ–º.

### 12.2. –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ SSH

**–ü—Ä–æ–±–ª–µ–º–∞:** `Permission denied (publickey)`

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SSH –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ GitHub Secrets (–ë–ï–ó passphrase!)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ `~/.ssh/authorized_keys` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: `chmod 600 ~/.ssh/authorized_keys` –∏ `chmod 700 ~/.ssh`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ workflow –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `webfactory/ssh-agent` (–æ–Ω –Ω–µ –Ω—É–∂–µ–Ω, –µ—Å–ª–∏ –∫–ª—é—á –±–µ–∑ passphrase)

### 12.3. –û—à–∏–±–∫–∞ Docker –∫–æ–º–∞–Ω–¥

**–ü—Ä–æ–±–ª–µ–º–∞:** `permission denied while trying to connect to the Docker daemon socket`

**–†–µ—à–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker: `sudo usermod -aG docker $USER`
2. –í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞: `docker ps` (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ sudo)

### 12.4. –û—à–∏–±–∫–∞ git pull

**–ü—Ä–æ–±–ª–µ–º–∞:** `error: Your local changes to the following files would be overwritten by merge`

**–†–µ—à–µ–Ω–∏—è:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `git reset --hard origin/main` –≤–º–µ—Å—Ç–æ `git pull`
2. –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ `git stash` –ø–µ—Ä–µ–¥ `git pull`
3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `git fetch` –∏ `git reset --hard origin/main`

### 12.5. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–¥–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs bot`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞

### 12.6. –ú–µ–¥–ª–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–µ–ø–ª–æ–π –∑–∞–Ω–∏–º–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

**–†–µ—à–µ–Ω–∏—è:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker layer caching
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ Dockerfile (–º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞)
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.dockerignore` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
4. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker registry –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤

---

## 13. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 13.1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker Registry

–î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–µ–ø–ª–æ—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker Registry (Docker Hub, GitHub Container Registry):

```yaml
- name: Build and push Docker image
  uses: docker/build-push-action@v5
  with:
    context: .
    push: true
    tags: your-username/ym-playlist-bot:latest
    cache-from: type=registry,ref=your-username/ym-playlist-bot:latest
    cache-to: type=inline

- name: Deploy to server
  uses: appleboy/ssh-action@v1.0.0
  with:
    script: |
      docker pull your-username/ym-playlist-bot:latest
      docker compose up -d bot
```

### 13.2. Blue-Green Deployment

–î–ª—è –Ω—É–ª–µ–≤–æ–≥–æ downtime –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å blue-green deployment:

```yaml
script: |
  # –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –¥—Ä—É–≥–∏–º –∏–º–µ–Ω–µ–º
  docker compose -f docker-compose.yml -f docker-compose.blue.yml up -d bot-blue
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
  # ... health check ...
  
  # –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è load balancer)
  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
  docker compose stop bot
```

### 13.3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

–î–æ–±–∞–≤—å—Ç–µ —à–∞–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:

```yaml
- name: Run tests
  run: |
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    pip install -r requirements.txt
    
    # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
    pytest tests/
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–∞
    flake8 .
    black --check .
```

### 13.4. –î–µ–ø–ª–æ–π –≤ staging –ø–µ—Ä–µ–¥ production

–°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π workflow –¥–ª—è staging:

```yaml
# .github/workflows/deploy-staging.yml
name: Deploy to Staging

on:
  push:
    branches:
      - develop

jobs:
  deploy-staging:
    # ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ production, –Ω–æ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ–∫—Ä–µ—Ç–∞–º–∏
```

---

## 14. –ß–µ–∫–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CI/CD

### 14.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Git –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker Compose –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

### 14.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH

- [ ] –°–æ–∑–¥–∞–Ω SSH –∫–ª—é—á –¥–ª—è CI/CD
- [ ] –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ `~/.ssh/authorized_keys`
- [ ] –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ GitHub Secrets (`DEPLOY_SSH_KEY`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ SSH

### 14.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

- [ ] `DEPLOY_HOST` ‚Äî IP-–∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞
- [ ] `DEPLOY_USER` ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è SSH
- [ ] `DEPLOY_SSH_KEY` ‚Äî –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
- [ ] `DEPLOY_PATH` ‚Äî –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] `DEPLOY_PORT` ‚Äî SSH –ø–æ—Ä—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 14.4. –°–æ–∑–¥–∞–Ω–∏–µ workflow

- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `.github/workflows/deploy.yml`
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –≤–µ—Ç–∫–∏ `main`
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (`workflow_dispatch`)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —à–∞–≥–∏

### 14.5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ workflow
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ push
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –æ—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)

### 14.6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å–µ–∫—Ä–µ—Ç—ã –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –æ—Ç–∫–∞—Ç–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–ø–æ–ª–∞–¥–æ–∫

---

## 15. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 15.1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–µ–ø–ª–æ–π

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
git add .
git commit -m "–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è"
git push origin main

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è workflow –∏ —Ä–∞–∑–≤–µ—Ä–Ω–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```

### 15.2. –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

1. –û—Ç–∫—Ä–æ–π—Ç–µ GitHub ‚Üí **Actions**
2. –í—ã–±–µ—Ä–∏—Ç–µ **Deploy to Production**
3. –ù–∞–∂–º–∏—Ç–µ **Run workflow**
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É `main`
5. –ù–∞–∂–º–∏—Ç–µ **Run workflow**

### 15.3. –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh user@server
cd /path/to/project
git log --oneline -10  # –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏
git checkout <commit-hash>  # –û—Ç–∫–∞—Ç –∫ –Ω—É–∂–Ω–æ–º—É –∫–æ–º–º–∏—Ç—É
docker compose build bot
docker compose stop bot
docker compose up -d bot
```

---

## 16. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ –∏ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –¥–µ–ø–ª–æ–µ.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–µ–ø–ª–æ–µ–≤ –≤ GitHub Actions

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CI/CD —Å–æ–≥–ª–∞—Å–Ω–æ —ç—Ç–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –¥–µ—Ç–∞–ª–∏

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** 2025-12-02  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ê–≤—Ç–æ—Ä:** AI Agent (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –∏ best practices CI/CD)

